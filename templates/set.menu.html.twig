{% extends "base.html.twig" %}

{% block title %}
    Menü választása - Webmenza
{% endblock title %}

{% block headtitle %}
    Menü választása
{% endblock headtitle %}

{% block script %}
<script>
    function resetform() {
        document.querySelectorAll('input.form-check-input:checked').forEach(i => i.checked = false);
        document.querySelector("form").submit();
    }
</script>
{% endblock %}

{% block content %}
<form method="post" action="#">
    <div class="mb-3">
        <label for="date" class="form-label">Nap:</label>
        <input type="date" name="date" id="date" class="form-control" required value="{{ date }}" onchange="window.location.href = 'set.menu.php?date='+this.value">
        <div class="d-flex justify-content-center">{% include "_calendar.html.twig" %}</div>
    </div>
    {% if menu != null %}
    <div class="accordion" id="accordionExample">
        {% for id, meal in menu %}
        <div class="accordion-item">
          <h2 class="accordion-header">
            <button class="accordion-button {% if meal.menu == null %}collapsed{% endif %}" type="button" data-bs-toggle="collapse" data-bs-target="#meal-{{ id }}" {% if meal.menu != null %}aria-expanded="true"{% endif %} aria-controls="meal-{{ id }}">
              {{ meal.mealName }}
            </button>
          </h2>
          <div id="meal-{{ id }}" class="accordion-collapse collapse {% if meal.menu != null %}show{% endif %}" data-bs-parent="#accordionExample">
            <div class="mb-3">
                <label class="form-label">Menü:</label>
            </div>
            <div class="accordion-body">
                {% if meal.menu != [] %}
                <div class="form-check my-2">
                    <input class="form-check-input" type="radio" name="meal-{{ id }}" id="meal-{{ id }}-null" value="null" {% if choices[id] is same as(null) and choices[id] is defined %} checked {% endif %} {% if fillable == false %}disabled{% endif %}>
                    <label class="form-check-label" for="meal-{{ id }}-null">
                      Erre a napra nem igénylek étkeztetést.
                    </label>
                </div>
                {% endif %}
                {% for item in meal.menu %}
                <div class="form-check my-2">
                    <input class="form-check-input" type="radio" name="meal-{{ id }}" id="meal-{{ id }}-{{ item.id }}" value="{{ item.id }}" {% if item.id == choices[id] %} checked {% endif %} {% if fillable == false %}disabled{% endif %}>
                    <label class="form-check-label" for="meal-{{ id }}-{{ item.id }}">
                      {{ item.id|menuletter }}: {{ item.description|nl2br }}
                    </label>
                </div>
                {% else %}
                <p>Ezen a napon ez az étkezés nem vehető igénybe.</p>
                {% endfor %}
                {% if id in requests %}
                <p>Erre az étkezésre benyújtottál egy lemondási kérelmet.</p>
                {% endif %}
                {% if fillable == false and choices[id] > 0 and enableModificationRequests %} 
                    <a role="button" href="request.modification.php?date={{ date }}&meal={{ id }}" class="btn btn-danger {% if id in requests %}disabled{% endif %}" {% if id in requests %}aria-disabled="true"{% endif %}><i class="bi bi-x-lg"></i> Lemondás</a>
                {% endif %}
            </div>
          </div>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    {% if menu != [] %}
    <button type="submit" class="btn btn-primary" {% if fillable == false %}disabled{% endif %}><i class="bi bi-floppy"></i> Mentés</button>
    {% if fillable %}
    <button type="button" class="btn btn-outline-danger" onclick="resetform()">Választás törlése</button>
    {% endif %}
    {% endif %}
</form>
{% endblock content %}